---
slug: lerna
title: lerna
author_url: https://github.com/ximoThorn
author_image_url: https://avatars.githubusercontent.com/u/32925631?s=60&v=4
tags: [npm, yarn, lerna]
---

# lerna
## ä¸€ã€ä½¿ç”¨lerna
### å®‰è£…lerna
```bash
  npm i lerna -g
```

### åˆå§‹åŒ–é¡¹ç›®
```bash
  mkdir lerna-project
  cd lerna-project

  lerna init
```
#### lerna.json
```json
{
  "packages": [
    "packages/*"
  ],
  "version": "0.0.0"
}
```

### yarn workspace
> ç®¡ç†é¡¹ç›®å½¢æˆå·¥ä½œç©ºé—´
> 
1ã€å°†node_modulesç›®å½•å®‰è£…åœ¨æ ¹ç›®å½•ä¸­ï¼Œå­é¡¹ç›®éƒ½å¯ä»¥è¯»åˆ°æ ¹ç›®å½•çš„node_modules
2ã€æ•´ä¸ªé¡¹ç›®åªæœ‰ä¸€ä¸ªyarn.lockæ–‡ä»¶
3ã€å­é¡¹ç›®ä¼šè¢«linkè‡³æ ¹ç›®å½•çš„node_modulesä¸­ï¼Œè¿™æ ·å…è®¸æˆ‘ä»¬åœ¨å­é¡¹ç›®ä¸­é€šè¿‡importç›´æ¥å¼•ç”¨å¦ä¸€ä¸ªå­é¡¹ç›®(éœ€æ‰§è¡Œyarn install)

#### å¼€å¯workspace
> package.jsonæ–‡ä»¶è®¾ç½®workspaceså±æ€§

```json
{
  "name": "root",
  "private": true,
  "workspaces": [
    "packages/*"
  ],
  "devDependencies": {
    "lerna": "^3.22.1"
  }
}
```

### åˆ›å»ºå­é¡¹ç›®
```bash
lerna create ihooks
```

### å®‰è£…ä¾èµ–
> é»˜è®¤æƒ…å†µä¸‹ä¸èƒ½å¾€æ ¹ç›®å½•é‡Œé¢æ·»åŠ æ¨¡å—çš„ï¼Œæ‰§è¡ŒğŸ‘‡å‘½ä»¤ä¼šå¿½ç•¥æ ¹ç©ºé—´ä¾èµ–æ£€æŸ¥ï¼Œå°†node_moduleså®‰è£…åœ¨æ ¹ç›®å½•ä¸­
```bash
yarn add chalk --ignore-workspace-root-check
```
> æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦å°†å­é¡¹ç›®ç‹¬äº«çš„ä¾èµ–å®‰è£…åœ¨å­é¡¹ç›®ä¸­æ€ä¹ˆåŠå‘¢ï¼Ÿæ‰§è¡ŒğŸ‘‡é¢å‘½ä»¤
```bash
yarn workspace ihooks add loadsh
```

### å­é¡¹ç›®å…±äº«ä¾èµ–
```js
yarn install
// æˆ–è€…
lerna bootstrap --npm-client yarn --use-workspaces
// --npm-client yarnä½¿ç”¨yarnä½œä¸ºnpmçš„å®¢æˆ·ç«¯
```

### å…¶å®ƒå‘½ä»¤

|ä½œç”¨|å‘½ä»¤|
--|--|--
|æŸ¥çœ‹å­ç©ºé—´ä¿¡æ¯|yarn workspaces info|
|åˆ é™¤æ‰€æœ‰node_modules|lerna clean / yarn workspaces run clean|
|é‡æ–°è·å–æ‰€æœ‰çš„node_modules|yarn install --force|
|æŸ¥çœ‹ç¼“å­˜ç›®å½•|yarn cache dir|
|æ¸…é™¤æœ¬åœ°ç¼“å­˜|yarn cache clean|

# å‚è€ƒæ–‡æ¡£

[yarn](https://yarn.bootcss.com/docs/cli/workspace/)ã€[lerna](https://github.com/lerna/lerna)
